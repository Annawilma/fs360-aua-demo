<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>FutureSkills360° - Ausbilder:innen, Ausbildungspersonal und Personalverantwortliche</title>
  <meta name="description" content="FutureSkills360° - Ausbilder:innen, Ausbildungspersonal und Personalverantwortliche. Antworten werden nur in dieser Sitzung gespeichert."/>

  <!-- Charts & PDF -->
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" defer></script>

  <style>
    :root{
      --bg:#f7fafc; --panel:#ffffff; --fg:#0f1720; --muted:#5c6b74;
      --cat-tech:#234B59;
      --cat-digi:#93B7BE;
      --cat-classic:#F5C396;
      --cat-trans:#78290F;
      --primary:#234b59; --primary-weak:#e7eff2; --primary-grad:#2f6677;
      --focus:#ffb703; --border:#d0d7de; --error:#b00020;
      --shadow:0 10px 20px rgba(0,0,0,.06), 0 3px 8px rgba(0,0,0,.04);
      --radius:16px;

      /* Seitenhintergrund (wird per JS zwischen 9 Bildern rotiert) */
      --page-bg-image: url("bg-body-1.webp");
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Noto Sans","Helvetica Neue",Arial,sans-serif;
      color:var(--fg);
      background:
        radial-gradient(1200px 600px at -10% -10%, #ecf4f7 20%, transparent 60%),
        radial-gradient(800px 500px at 110% -10%, #eaf2f6 20%, transparent 60%),
        var(--bg);
      line-height:1.6;
      position:relative;
    }
    /* EIN Seitenhintergrundbild, wird gedimmt */
    body::before{
      content:""; position:fixed; inset:0; z-index:0; pointer-events:none;
      background-image: var(--page-bg-image);
      background-size: cover; background-position: center; background-repeat: no-repeat;
      opacity: 0.14;
    }

    .hero{
      background:linear-gradient(135deg, var(--primary) 0%, var(--primary-grad) 100%);
      color:#fff; padding:28px 0 24px; position:sticky; top:0; z-index:5; overflow:hidden;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
    }
    /* Ruhiger Header: KEIN Bild */
    .hero::before{ content:""; position:absolute; inset:0; pointer-events:none; }
    .hero .container{ position:relative; z-index:1; }

    .container{max-width:1000px;margin:0 auto;padding:0 1.25rem}
    .hero h1{margin:0;font-size:clamp(1.3rem,2.5vw,1.9rem);letter-spacing:.2px;font-weight:800}
    .hero p.lead{margin:.35rem 0 0;opacity:.95}
    .shell{max-width:1000px;margin:18px auto;padding:0 1.25rem 40px}
    .card{border:1px solid var(--border);border-radius:var(--radius);padding:1.1rem;margin:1rem 0;background:var(--panel);box-shadow:var(--shadow)}

    .actions{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.9rem}
    button,.btn{
      appearance:none;border:2px solid var(--primary);background:var(--primary);color:#fff;
      padding:.75rem 1.1rem;border-radius:14px;cursor:pointer;font-weight:750;letter-spacing:.2px;
      transition:transform .06s,box-shadow .2s,background .2s,color .2s;
      box-shadow:0 8px 14px rgba(35,75,89,.22);
    }
    button:hover{transform:translateY(-1px);box-shadow:0 12px 18px rgba(35,75,89,.28)}
    .secondary{background:transparent;color:var(--primary)}
    button:focus,input:focus{outline:3px solid var(--focus);outline-offset:2px}

    .muted{color:var(--muted)}
    .hidden{display:none!important}
    .err{color:var(--error);margin-top:.5rem}

    fieldset{border:none;padding:0;margin:0}
    legend{font-weight:800;margin-bottom:.7rem;font-size:1.05rem}

    .option{
      display:flex;align-items:flex-start;gap:.8rem;border:1.5px solid var(--border);
      border-radius:14px;padding:.85rem 1rem;margin:.55rem 0;background:#fff;
      transition:border-color .2s,background .2s,transform .06s;box-shadow:0 2px 6px rgba(0,0,0,.04)
    }
    .option:hover{background:var(--primary-weak);border-color:var(--primary);transform:translateY(-1px)}
    .optIndex{
      flex:0 0 2rem;height:2rem;border-radius:10px;display:flex;align-items:center;justify-content:center;
      font-weight:800;border:1px solid var(--border);background:#f4f7f9
    }
    .option input{margin-top:.25rem}
    .option span.txt{display:block;margin-top:.1rem}

    .grid-2{display:grid;grid-template-columns:1fr;gap:1rem}
    @media (min-width:960px){.grid-2{grid-template-columns:1.05fr .95fr}}

    table{width:100%;border-collapse:collapse;margin-top:1rem;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.05)}
    th,td{text-align:left;border-bottom:1px solid var(--border);padding:.6rem .7rem}
    th{background:#f3f6f8;font-weight:800}

    .progress{width:100%;height:14px;background:#e9eef2;border-radius:999px;overflow:hidden;border:1px solid #d8e0e6}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--primary),#2f6f85);transition:width .25s ease}

    .toprow{display:flex;align-items:center;justify-content:space-between;gap:1rem;margin-bottom:.8rem;flex-wrap:wrap}

    /* Dezentes Bild im Ergebnisbereich */
    /* Ergebnisbereich mit dezentem Hintergrundbild */
    /* bessere Lesbarkeit der Skillnamen in der Tabelle */
#tableWrap table td:first-child{
  hyphens:auto;           /* Silbentrennung (Sprache ist schon lang="de") */
  overflow-wrap: anywhere;/* bricht lange Wörter */
  word-break: normal;
  max-width: 0;           /* erlaubt Zeilenumbruch in flexiblen Tabellen */
}
#results{
  position:relative;
  overflow:hidden;
  isolation:isolate; /* eigener Stacking-Context */
}
#results::before{
  content:"";
  position:absolute; inset:0;
  pointer-events:none; z-index:0;

  /* Erst WebP, dann JPG als Fallback */
  background-image:
    url("IDW_201222_0902_1920.webp"),
    url("IDW_201222_0902.jpg");
  background-size: cover;
  background-position: center 35%; /* bei Bedarf anpassen (0–100%) */
  background-repeat: no-repeat;

  opacity:.18; /* Sichtbarkeit: 0.12 (dezenter) – 0.24 (kräftiger) */
}
/* Inhalt über dem Bild */
#results > *{ position:relative; z-index:1; }
</style>
</head>
<body>
  <div class="hero">
    <div class="container">
      <h1 id="title">FutureSkills360° - Ausbilder:innen, Ausbildungspersonal und Personalverantwortliche</h1>
      <p class="lead">Zielgruppe: Ausbilder:innen, Ausbildungspersonal und Personalverantwortliche · Antworten werden nur in dieser Sitzung gespeichert</p>
    </div>
  </div>

  <main class="shell" role="main">
    <section id="intro" class="card" aria-labelledby="intro-h">
      <h2 id="intro-h" style="margin:.2rem 0 .4rem;font-size:1.2rem;">Kurz erklärt</h2>
      <p>Sie bearbeiten <strong id="countScenarios"></strong> kurze <strong>Szenarien</strong>. Tipp: Mit den Tasten <strong>1–4</strong> wählen Sie eine Antwort.</p>
      <div class="toprow">
        <span class="muted" id="estTime"></span>
      </div>
      <div class="actions">
        <button id="startBtn" aria-describedby="start-hint">FutureSkills360° starten</button>
        <button id="skipToResults" class="secondary" type="button" title="Nur Demo der Auswertung anzeigen">Nur Auswertung zeigen</button>
        <p id="start-hint" class="sr-only">Startet das erste Szenario.</p>
      </div>
    </section>

    <section id="break" class="card hidden" aria-live="polite">
      <h2>Kurze Pause</h2>
      <p>Abschnitt abgeschlossen. Kurz durchatmen – weiter geht’s, wenn Sie bereit sind.</p>
      <div class="actions"><button id="breakNextBtn" type="button">Weiter</button></div>
    </section>

    <section id="quiz" class="card hidden" aria-live="polite">
      <div class="toprow">
        <div class="progress" aria-label="Fortschrittsbalken"><div id="pbar" class="bar"></div></div>
        <div class="muted"><span id="progressText"></span></div>
      </div>
      <form id="qForm" novalidate>
        <fieldset>
          <legend id="qText">Szenario</legend>
          <div id="options"></div>
        </fieldset>
      </form>
      <div class="err" id="error" role="alert" aria-live="assertive"></div>
      <div class="actions">
        <button id="prevBtn" class="secondary" type="button">Zurück</button>
        <button id="nextBtn" type="button">Weiter</button>
      </div>
      <p class="muted" style="margin:.5rem 0 0;">Tastatur: <strong>1–4</strong> wählen Antwort, <strong>Enter</strong> weiter, <strong>Backspace</strong> zurück.</p>
    </section>

    <section id="results" class="card hidden" aria-labelledby="res-h">
      <h2 id="res-h" style="margin-top:.2rem;">Ihre Auswertung</h2>
      <div class="grid-2">
        <div>
          <div id="chart" role="img" aria-label="Sunburst-Diagramm der Future Skills"></div>
          <div class="actions" style="margin-top:.8rem;">
            <button id="copyBtn" type="button" class="secondary">Kurzreport kopieren</button>
            <button id="pdfBtn" type="button">PDF herunterladen</button>
            <button id="resetBtn" type="button" class="secondary">Zurücksetzen</button>
          </div>
        </div>
        <div>
          <h3 style="margin:.2rem 0;">Textuelle Übersicht (barrierefrei)</h3>
          <p class="muted">Auflistung aller 26 Skills mit Punkten. Die Summen je Kategorie sehen Sie im Diagramm.</p>
          <div id="tableWrap"></div>
        </div>
      </div>
    </section>
  </main>

<script>
/* ===== Rotierender Seitenhintergrund (9 Bilder) ===== */
const BG_IMAGES_PAGE = [
  "bg-body-1.webp","bg-body-2.webp","bg-body-3.webp","bg-body-4.webp","bg-body-5.webp",
  "bg-body-6.webp","bg-body-7.webp","bg-body-8.webp","bg-body-9.webp"
];
function setBgFromIndex(i){
  const img = BG_IMAGES_PAGE[i % BG_IMAGES_PAGE.length];
  document.documentElement.style.setProperty('--page-bg-image', `url("${img}")`);
}
document.addEventListener('DOMContentLoaded', ()=>{ try{ setBgFromIndex(0); }catch(e){} });

/* ===== Kategorien & Labels ===== */
const CATEGORIES = {
  "Technologische_Kompetenzen": [
    "KI_Datenkompetenz","Softwareentwicklung","Nutzerzentriertes_Design","Digitale_Infrastruktur_und_Cybersicherheit","Hardware_Robotikentwicklung","Prompt_Engineering"
  ],
  "Digitale_Schluesselkompetenzen": [
    "Digital_Literacy","Digitale_Ethik_und_KI_Governance","Digitale_Kollaboration","KI_gestuetztes_Lernen_und_Weiterbildung","Datenmanagement"
  ],
  "Klassische_Kompetenzen": [
    "Unternehmerisches_Denken_und_Innovationsgeist","Eigenverantwortung_und_Selbstwirksamkeit","Agilitaet","Loesungsfaehigkeit","Kreativitaet","Interkulturelle_Kommunikation","Resilienz","Freundlichkeit","Selbstbewusstsein","Werteorientiertes_Handeln","Weltoffenheit"
  ],
  "Transformative_Kompetenzen": [
    "Urteilsfaehigkeit","Innovationskompetenz","Veraenderungskompetenz","Dialog_und_Konfliktfaehigkeit"
  ]
};

const SKILL_LABELS = {
  "KI_Datenkompetenz":"KI-Datenkompetenz",
  "Softwareentwicklung":"Softwareentwicklung",
  "Nutzerzentriertes_Design":"Nutzerzentriertes Design",
  "Digitale_Infrastruktur_und_Cybersicherheit":"Digitale Infrastruktur & Cybersicherheit",
  "Hardware_Robotikentwicklung":"Hardware-/Robotikentwicklung",
  "Prompt_Engineering":"Prompt Engineering",
  "Digital_Literacy":"Digital Literacy",
  "Digitale_Ethik_und_KI_Governance":"Digitale Ethik & KI-Governance",
  "Digitale_Kollaboration":"Digitale Kollaboration",
  "KI_gestuetztes_Lernen_und_Weiterbildung":"KI-gestütztes Lernen & Weiterbildung",
  "Datenmanagement":"Datenmanagement",
  "Unternehmerisches_Denken_und_Innovationsgeist":"Unternehmerisches Denken & Innovationsgeist",
  "Eigenverantwortung_und_Selbstwirksamkeit":"Eigenverantwortung & Selbstwirksamkeit",
  "Agilitaet":"Agilität",
  "Loesungsfaehigkeit":"Lösungsfähigkeit",
  "Kreativitaet":"Kreativität",
  "Interkulturelle_Kommunikation":"Interkulturelle Kommunikation",
  "Resilienz":"Resilienz",
  "Freundlichkeit":"Freundlichkeit (Kindness)",
  "Selbstbewusstsein":"Selbstbewusstsein",
  "Werteorientiertes_Handeln":"Werteorientiertes Handeln",
  "Weltoffenheit":"Weltoffenheit",
  "Urteilsfaehigkeit":"Urteilsfähigkeit",
  "Innovationskompetenz":"Innovationskompetenz",
  "Veraenderungskompetenz":"Veränderungskompetenz",
  "Dialog_und_Konfliktfaehigkeit":"Dialog- & Konfliktfähigkeit"
};

/* ===== Szenarien (dein Block) ===== */
const SCENARIOS = [{"id": "AUA_1", "text": "Ein:e Azubi:ne kommt nach der Berufsschule in die Werkstatt und wirkt völlig demotiviert.", "options": [{"id": "A", "label": "Ich nehme mir kurz Zeit, frage konkret nach, was in der Schule passiert ist, und höre zu. Danach gebe ich eine kleine, sichtbare Aufgabe: z. B. die Werkzeugkiste für den nächsten Tag herrichten. Am Ende lobe ich die Arbeit – so erlebt der/die Azubi:ne trotz Frust ein Erfolgserlebnis.", "skills": [{"key": "Resilienz", "weight": 1}]}, {"id": "B", "label": "Ich übertrage eine konkrete Aufgabe mit Verantwortung, z. B. die Materialbestellung für ein Projekt. Wenn der/die Azubi:ne merkt, dass es nur an ihm/ihr hing und funktioniert hat, stärkt das sein/ihr Selbstvertrauen.", "skills": [{"key": "Eigenverantwortung_und_Selbstwirksamkeit", "weight": 1}]}, {"id": "C", "label": "Ich mache daraus ein Spiel: „Wer baut den stabilsten Werkzeugständer aus Restmaterialien?“ Am Ende präsentiere ich den Entwurf vor der Gruppe und lobe ihn/sie – so fühlt sich der/die Azubi:ne eingebunden.", "skills": [{"key": "Kreativitaet", "weight": 1}, {"key": "Freundlichkeit", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_2", "text": "Im Betrieb wird ein neues digitales Planungstool eingeführt. Einige Azubis sind unsicher.", "options": [{"id": "A", "label": "Ich setze die Azubis an den Rechner und lasse sie sofort eine Aufgabe eintragen: „Tragt bitte eure Berufsschultage der nächsten Woche ein.“ So üben sie im direkten Tun.", "skills": [{"key": "Digital_Literacy", "weight": 1}]}, {"id": "B", "label": "Ich bilde Tandems (ein erfahrener und ein unsicherer Azubi:ne). Gemeinsam erstellen sie den Schichtplan und stellen ihn im Team vor. So lernen sie digitale Abstimmung und Verantwortung.", "skills": [{"key": "Digitale_Kollaboration", "weight": 1}]}, {"id": "C", "label": "Vor dem Start frage ich: „Was passiert, wenn jemand sein Passwort weitergibt?“ Dann erkläre ich mit einem echten Beispiel, dass ein falscher Eintrag im Betrieb große Folgen haben kann.", "skills": [{"key": "Digitale_Ethik_und_KI_Governance", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_3", "text": "Zwei Azubis geraten über die Arbeitsaufteilung in Streit.", "options": [{"id": "A", "label": "Ich hole beide aus der Werkstatt, lasse jede:n nacheinander erklären und leite die Frage ein: „Wie würdet ihr es lösen, wenn ihr die Entscheidung für die Gruppe trefft?“ So entwickeln sie meist selbst eine Lösung.", "skills": [{"key": "Dialog_und_Konfliktfaehigkeit", "weight": 1}]}, {"id": "B", "label": "Ich erinnere beide daran, dass Teamarbeit heißt, sich gegenseitig zu unterstützen. Dann fordere ich sie auf, dem/der anderen etwas Positives zu nennen, das er/sie gut gemacht hat.", "skills": [{"key": "Freundlichkeit", "weight": 1}]}, {"id": "C", "label": "Wenn es keine Einigung gibt, treffe ich die Entscheidung, erkläre sie aber klar: „Du übernimmst die Schweißarbeiten, weil du das Werkzeug am besten beherrschst, und du führst die Doku, weil du darin schneller bist.“ So bleibt es fair.", "skills": [{"key": "Urteilsfaehigkeit", "weight": 1}, {"key": "Werteorientiertes_Handeln", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_4", "text": "In der Werkstatt wird ein neuer Robotik-Prototyp getestet. Die Azubis haben bisher kaum Erfahrung.", "options": [{"id": "A", "label": "Ich zeige die Grundfunktionen am Prototyp, erkläre Sensoren und Motorik und lasse die Azubis einfache Handgriffe testen.", "skills": [{"key": "Hardware_Robotikentwicklung", "weight": 1}]}, {"id": "B", "label": "Wir lesen die Bewegungsdaten und Fehlerprotokolle des Roboters aus. Ich erkläre, wie diese mit KI-Systemen ausgewertet werden, um Muster oder Störungen zu erkennen.", "skills": [{"key": "KI_Datenkompetenz", "weight": 1}]}, {"id": "C", "label": "Ich gebe die Aufgabe: „Überlegt euch spontan drei Einsatzmöglichkeiten für den Roboter.“ Eine Gruppe denkt an den Transport von Werkstücken, eine an Sicherheitsprüfungen. Danach skizzieren sie ihre Ideen.", "skills": [{"key": "Agilitaet", "weight": 1}, {"key": "Kreativitaet", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_5", "text": "Ein:e Azubi:ne hat Schwierigkeiten, Aufgaben rechtzeitig abzugeben.", "options": [{"id": "A", "label": "Ich teile die Aufgabe in Teilschritte und lasse den/die Azubi:ne selbst die Termine in den Kalender eintragen. Nach jeder Abgabe reflektieren wir, was gut lief.", "skills": [{"key": "Eigenverantwortung_und_Selbstwirksamkeit", "weight": 1}]}, {"id": "B", "label": "Wir simulieren eine Störung: Ein neuer Auftrag kommt rein. Der/die Azubi:ne muss seine/ihre Reihenfolge umstellen und erklären, wie er/sie trotzdem fristgerecht abgibt.", "skills": [{"key": "Agilitaet", "weight": 1}, {"key": "Loesungsfaehigkeit", "weight": 1}]}, {"id": "C", "label": "Wenn er/sie trotz Planung scheitert, bespreche ich: „Was hat dich aufgehalten?“ Dann entwickeln wir Gegenstrategien, z. B. Pausen besser planen oder rechtzeitig Hilfe holen. So lernt er/sie, Rückschläge wegzustecken.", "skills": [{"key": "Resilienz", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_6", "text": "Die Azubis sollen erstmals ein Projekt eigenständig planen.", "options": [{"id": "A", "label": "Ich lasse sie ein Konzept erarbeiten, Kosten kalkulieren und anschließend im Team präsentieren. So üben sie, unternehmerisch zu denken.", "skills": [{"key": "Unternehmerisches_Denken_und_Innovationsgeist", "weight": 1}]}, {"id": "B", "label": "Sie nutzen ein digitales Whiteboard, sammeln Ideen mit Post-its und stimmen sich im Team über die Plattform ab. Dadurch lernen sie kreative Methoden in digitaler Zusammenarbeit kennen.", "skills": [{"key": "Kreativitaet", "weight": 1}, {"key": "Digitale_Kollaboration", "weight": 1}]}, {"id": "C", "label": "Am Ende besprechen wir die Vorschläge systematisch: Was ist machbar, was zu teuer, was bringt den größten Nutzen? So lernen sie, Entscheidungen nachvollziehbar zu begründen.", "skills": [{"key": "Urteilsfaehigkeit", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_7", "text": "Ein:e Azubi:ne ist sehr still und beteiligt sich kaum an Diskussionen.", "options": [{"id": "A", "label": "Ich gebe ihm/ihr den Auftrag, beim nächsten Meeting einen kleinen Fortschritt zu präsentieren. Nach und nach bekommt er/sie so die Sicherheit, vor anderen zu sprechen.", "skills": [{"key": "Selbstbewusstsein", "weight": 1}]}, {"id": "B", "label": "Ich sorge dafür, dass das Team ihn/sie nicht unterbricht, und betone, dass Respekt und Wertschätzung unsere Arbeitskultur prägen.", "skills": [{"key": "Freundlichkeit", "weight": 1}, {"key": "Werteorientiertes_Handeln", "weight": 1}]}, {"id": "C", "label": "Falls Unsicherheit durch kulturelle Unterschiede entsteht, spreche ich das offen an und unterstütze ihn/sie, die eigene Perspektive einzubringen.", "skills": [{"key": "Interkulturelle_Kommunikation", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_8", "text": "Die Azubis sollen ein digitales Projektboard nutzen, um ihre Arbeit zu organisieren.", "options": [{"id": "A", "label": "Jede Gruppe trägt ihre Aufgaben ein und markiert den Fortschritt. Am Ende der Woche sehen alle, wie weit die Teams sind.", "skills": [{"key": "Digitale_Kollaboration", "weight": 1}]}, {"id": "B", "label": "Wir legen klare Regeln fest: Dateinamen, Versionen und Zuständigkeiten. So bleibt die Übersicht erhalten.", "skills": [{"key": "Datenmanagement", "weight": 1}]}, {"id": "C", "label": "Ich erkläre, wie Filter und Benachrichtigungen funktionieren, und lasse sie in einer Übung spontan Aufgaben verschieben, wenn Prioritäten sich ändern.", "skills": [{"key": "Digital_Literacy", "weight": 1}, {"key": "Agilitaet", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_9", "text": "Ein:e Azubi:ne bringt eine ungewöhnliche Idee zur Verbesserung eines Arbeitsablaufs ein.", "options": [{"id": "A", "label": "Ich gebe Raum, die Idee mit einem kleinen Modell oder Ablaufplan zu skizzieren und dem Team vorzustellen.", "skills": [{"key": "Kreativitaet", "weight": 1}]}, {"id": "B", "label": "Gemeinsam prüfen wir, ob die Idee praktikabel ist, und bewerten Kosten, Nutzen und Zeitaufwand.", "skills": [{"key": "Innovationskompetenz", "weight": 1}, {"key": "Urteilsfaehigkeit", "weight": 1}]}, {"id": "C", "label": "Ich motiviere das Team, die Idee in einem Testlauf auszuprobieren, auch wenn sie ungewohnt ist.", "skills": [{"key": "Veraenderungskompetenz", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_10", "text": "Im Online-Unterricht sind mehrere Azubis unkonzentriert und mit dem Handy beschäftigt.", "options": [{"id": "A", "label": "Ich zeige, wie KI-Tools wie Quiz-Apps oder automatische Zusammenfassungen helfen können, den Stoff zu wiederholen.", "skills": [{"key": "KI_gestuetztes_Lernen_und_Weiterbildung", "weight": 1}]}, {"id": "B", "label": "Wir üben, wie man seriöse Informationen im Netz findet und Quellen überprüft.", "skills": [{"key": "Digital_Literacy", "weight": 1}]}, {"id": "C", "label": "Ich fordere die Azubis auf, ihre Lernzeit selbst einzuteilen, und bespreche, wie man auch bei Langeweile oder Schwierigkeiten am Ball bleibt.", "skills": [{"key": "Eigenverantwortung_und_Selbstwirksamkeit", "weight": 1}, {"key": "Resilienz", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_12", "text": "Ein Azubi wirkt überfordert, weil er mehrere Aufgaben parallel erledigen soll.", "options": [{"id": "A", "label": "Wir teilen die Aufgaben auf, erstellen eine Prioritätenliste und vereinbaren klare Reihenfolgen.", "skills": [{"key": "Loesungsfaehigkeit", "weight": 1}]}, {"id": "B", "label": "Ich simuliere mit ihm eine Änderung im Ablaufplan: plötzlich hat ein Auftrag Vorrang. Er lernt, flexibel umzustellen und trotzdem dranzubleiben.", "skills": [{"key": "Agilitaet", "weight": 1}, {"key": "Resilienz", "weight": 1}]}, {"id": "C", "label": "Ich lasse ihn eine eigene Wochenplanung erarbeiten und sie vor dem Team präsentieren. So sieht er, dass er die Abläufe auch selbst steuern kann.", "skills": [{"key": "Eigenverantwortung_und_Selbstwirksamkeit", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_13", "text": "Die Geschäftsführung möchte mehr Prozesse digitalisieren, viele Azubis reagieren skeptisch.", "options": [{"id": "A", "label": "Ich erkläre, dass Veränderungen normal sind, und zeige Schritt für Schritt, wie wir den Umstieg begleiten.", "skills": [{"key": "Veraenderungskompetenz", "weight": 1}]}, {"id": "B", "label": "Wir prüfen konkret: Welche Prozesse machen digital Sinn, welche nicht? Dabei achten wir auch auf Datenschutz und Verantwortlichkeiten.", "skills": [{"key": "Urteilsfaehigkeit", "weight": 1}, {"key": "Digitale_Ethik_und_KI_Governance", "weight": 1}]}, {"id": "C", "label": "Ich fordere die Azubis auf, selbst Ideen einzubringen, wie digitale Tools die Arbeit erleichtern könnten, und lasse sie kleine Tests durchführen.", "skills": [{"key": "Innovationskompetenz", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_14", "text": "In der Werkstatt fällt regelmäßig ein System aus, und die Ursache ist unklar.", "options": [{"id": "A", "label": "Ich lasse die Azubis mit Messgeräten die Bauteile prüfen, um Fehlerquellen zu finden.", "skills": [{"key": "Hardware_Robotikentwicklung", "weight": 1}]}, {"id": "B", "label": "Gemeinsam sehen wir uns die Steuerungssoftware an und suchen gezielt nach Fehlern in der Programmierung.", "skills": [{"key": "Softwareentwicklung", "weight": 1}, {"key": "Loesungsfaehigkeit", "weight": 1}]}, {"id": "C", "label": "Wir testen, ob Netzwerkprobleme oder fehlende Updates die Ausfälle verursachen.", "skills": [{"key": "Digitale_Infrastruktur_und_Cybersicherheit", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_15", "text": "Ein Azubi gibt bei komplizierten Aufgaben schnell auf.", "options": [{"id": "A", "label": "Ich ermutige ihn, durch kleine Teilerfolge dranzubleiben, und erinnere ihn daran, dass Fehler normal sind.", "skills": [{"key": "Resilienz", "weight": 1}]}, {"id": "B", "label": "Ich lasse ihn selbst Vorschläge machen, wie er an die Aufgabe herangehen könnte, und begleite ihn dabei.", "skills": [{"key": "Eigenverantwortung_und_Selbstwirksamkeit", "weight": 1}, {"key": "Loesungsfaehigkeit", "weight": 1}]}, {"id": "C", "label": "Wir probieren bewusst verschiedene Herangehensweisen aus, damit er merkt, dass es oft mehrere Wege zum Ziel gibt.", "skills": [{"key": "Agilitaet", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_16", "text": "Die Azubis sollen in Teams eine Präsentation mit digitalen Medien vorbereiten.", "options": [{"id": "A", "label": "Ich gebe die Aufgabe: „Gestaltet die Präsentation mit Bildern, Videos oder kurzen Clips.“ Sie teilen die Arbeit über ein Online-Board auf und entwickeln gemeinsam ein kreatives Endprodukt.", "skills": [{"key": "Digitale_Kollaboration", "weight": 1}, {"key": "Kreativitaet", "weight": 1}]}, {"id": "B", "label": "Wir üben, wie man seriöse Quellen auswählt, Zitate korrekt angibt und Inhalte sinnvoll einbindet.", "skills": [{"key": "Digital_Literacy", "weight": 1}]}, {"id": "C", "label": "Jeder Azubi stellt einen Teil der Präsentation in einer Probe vor der Gruppe. Ich gebe gezieltes Feedback, damit sie Sicherheit vor Publikum gewinnen.", "skills": [{"key": "Selbstbewusstsein", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_17", "text": "Ein Azubi hat einen Fehler gemacht und fürchtet eine strenge Rüge.", "options": [{"id": "A", "label": "Ich erkläre, dass Fehler passieren, aber Verantwortung wichtig ist. Er soll den Fehler selbst offenlegen und wir überlegen gemeinsam, wie es besser geht.", "skills": [{"key": "Resilienz", "weight": 1}, {"key": "Werteorientiertes_Handeln", "weight": 1}]}, {"id": "B", "label": "Ich bespreche den Vorfall im Vier-Augen-Gespräch: „Was ist passiert, und wie gehst du beim nächsten Mal vor?“ So wird der Fehler sachlich aufgearbeitet.", "skills": [{"key": "Dialog_und_Konfliktfaehigkeit", "weight": 1}]}, {"id": "C", "label": "Ich fordere ihn auf, seine Arbeitsweise anzupassen, z. B. durch eine zusätzliche Kontrolle, und begleite die Umsetzung.", "skills": [{"key": "Veraenderungskompetenz", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_18", "text": "Die Azubis sollen mit einem KI-gestützten Tool ihre Lernfortschritte dokumentieren.", "options": [{"id": "A", "label": "Ich zeige, wie das Tool Lernstände auswertet, und lasse die Azubis ihre Stärken und Schwächen sichtbar machen.", "skills": [{"key": "KI_gestuetztes_Lernen_und_Weiterbildung", "weight": 1}]}, {"id": "B", "label": "Wir legen gemeinsam Ordnerstrukturen an und Regeln für die Ablage der Ergebnisse, damit später alles nachvollziehbar bleibt.", "skills": [{"key": "Datenmanagement", "weight": 1}]}, {"id": "C", "label": "Ich bespreche mit den Azubis, wie sie die Auswertungen kritisch lesen können, um nicht blind auf Zahlen zu vertrauen.", "skills": [{"key": "Digital_Literacy", "weight": 1}, {"key": "Urteilsfaehigkeit", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_19", "text": "Das Unternehmen möchte neue Märkte erschließen, die Azubis sollen Ideen beisteuern.", "options": [{"id": "A", "label": "Ich gebe den Auftrag: „Überlegt, wie wir neue Kunden gewinnen könnten.“ Die Azubis entwickeln konkrete Vorschläge und präsentieren sie.", "skills": [{"key": "Unternehmerisches_Denken_und_Innovationsgeist", "weight": 1}]}, {"id": "B", "label": "Wir diskutieren, wie man unterschiedliche Kulturen anspricht, z. B. durch Sprachvarianten oder angepasste Werbung.", "skills": [{"key": "Weltoffenheit", "weight": 1}, {"key": "Interkulturelle_Kommunikation", "weight": 1}]}, {"id": "C", "label": "Gemeinsam wägen wir Chancen und Risiken der Vorschläge ab und entscheiden, welche Ansätze wir testen.", "skills": [{"key": "Urteilsfaehigkeit", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_20", "text": "Ein Azubi bringt einen Verbesserungsvorschlag für den Ablauf in der Ausbildung ein.", "options": [{"id": "A", "label": "Ich lasse ihn den Vorschlag konkret im Team vorstellen und gebe Raum für Rückfragen. Danach planen wir gemeinsam einen Testlauf.", "skills": [{"key": "Innovationskompetenz", "weight": 1}]}, {"id": "B", "label": "Wir spinnen die Idee im Team weiter, bauen Beispiele und passen sie an die Realität an. So erlebt er, wie aus einer Idee ein Konzept entsteht.", "skills": [{"key": "Kreativitaet", "weight": 1}]}, {"id": "C", "label": "Ich übertrage ihm die Verantwortung für die Umsetzung im Kleinen und begleite die Veränderungen Schritt für Schritt.", "skills": []}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_21", "text": "Die Azubis sollen mit einem KI-Tool (z. B. ChatGPT) eine kurze Anleitung für die Werkstatt erstellen.", "options": [{"id": "A", "label": "Ich lasse sie ausprobieren, wie sich die Antworten verändern, wenn sie ihre Fragen präziser formulieren.", "skills": [{"key": "Prompt_Engineering", "weight": 1}]}, {"id": "B", "label": "Wir vergleichen die KI-Ausgabe mit Fachliteratur und prüfen, ob die Inhalte korrekt sind.", "skills": [{"key": "Digital_Literacy", "weight": 1}]}, {"id": "C", "label": "Die Azubis verfassen spielerische Prompts, z. B. im Stil einer Comicfigur, um zu sehen, wie flexibel die KI reagiert.", "skills": [{"key": "Kreativitaet", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_22", "text": "Wir wollen die Azubi-Mappe im Betrieb digital überarbeiten.", "options": [{"id": "A", "label": "Die Azubis befragen andere Azubis, welche Infos sie wirklich brauchen, und passen das Layout danach an.", "skills": [{"key": "Nutzerzentriertes_Design", "weight": 1}]}, {"id": "B", "label": "Sie erarbeiten die Mappe gemeinsam in einem Online-Tool und stimmen die Änderungen ab.", "skills": [{"key": "Digitale_Kollaboration", "weight": 1}]}, {"id": "C", "label": "Ich betone, dass die Mappe fair und praxisnah sein muss, nicht nur „schön“.", "skills": [{"key": "Werteorientiertes_Handeln", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_23", "text": "Ein kleines Script soll Routineaufgaben (z. B. Dateneingabe) erleichtern.", "options": [{"id": "A", "label": "Ich lasse die Azubis mit einfachen Programmierbausteinen ein Script entwickeln, das automatisch Listen erstellt.", "skills": [{"key": "Softwareentwicklung", "weight": 1}]}, {"id": "B", "label": "Wir prüfen, ob die Daten korrekt übertragen werden und wie man sie sicher speichert.", "skills": [{"key": "Datenmanagement", "weight": 1}]}, {"id": "C", "label": "Gemeinsam suchen wir Fehler im Script und überlegen, wie es verbessert werden kann.", "skills": [{"key": "Loesungsfaehigkeit", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_24", "text": "Das Unternehmen hat eine Kooperation mit einem Betrieb im Ausland.", "options": [{"id": "A", "label": "Ich ermuntere die Azubis, neugierig auf Unterschiede zu reagieren, z. B. durch Nachfragen nach Arbeitsweisen oder Feiertagen.", "skills": [{"key": "Weltoffenheit", "weight": 1}]}, {"id": "B", "label": "Wir üben, wie man Missverständnisse klärt, wenn Fachbegriffe unterschiedlich genutzt werden.", "skills": [{"key": "Interkulturelle_Kommunikation", "weight": 1}]}, {"id": "C", "label": "Ich mache klar, dass Respekt und Interesse wichtiger sind als perfekte Sprachkenntnisse.", "skills": [{"key": "Freundlichkeit", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_25", "text": "Ein Azubi soll erstmals vor der Geschäftsführung ein Projektergebnis vorstellen.", "options": [{"id": "A", "label": "Ich lasse ihn die Präsentation mehrfach in kleiner Runde üben und gebe Feedback zu Stimme, Haltung und Auftreten.", "skills": [{"key": "Selbstbewusstsein", "weight": 1}]}, {"id": "B", "label": "Er darf eigene Visualisierungen oder Praxisbeispiele einbauen, um die Präsentation lebendiger zu machen.", "skills": [{"key": "Kreativitaet", "weight": 1}]}, {"id": "C", "label": "Sollte er ins Stocken geraten, ermutige ich ihn, sofort nochmal zu starten, damit er merkt, dass man Rückschläge überwinden kann.", "skills": [{"key": "Resilienz", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_26", "text": "Die Azubis sollen eine Schichtplanung erstellen, bei der manche mehr ungeliebte Aufgaben übernehmen müssten.", "options": [{"id": "A", "label": "Ich fordere sie auf, eine faire Lösung zu entwickeln, die die Belastungen gleichmäßig verteilt.", "skills": [{"key": "Werteorientiertes_Handeln", "weight": 1}]}, {"id": "B", "label": "Wir besprechen offen, wo Unzufriedenheit besteht, und suchen einen Kompromiss.", "skills": [{"key": "Dialog_und_Konfliktfaehigkeit", "weight": 1}]}, {"id": "C", "label": "Ich erkläre, dass manchmal betriebliche Notwendigkeiten Vorrang haben, und begründe die Entscheidung transparent.", "skills": [{"key": "Urteilsfaehigkeit", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_27", "text": "Die Azubis sollen die Bedienungsanleitung für eine neue Maschine einfacher gestalten.", "options": [{"id": "A", "label": "Ich lasse sie die Anleitung Azubi-gerecht umschreiben und mit Piktogrammen versehen. Danach testen andere Azubis, ob sie die Schritte verstehen.", "skills": [{"key": "Nutzerzentriertes_Design", "weight": 1}]}, {"id": "B", "label": "Sie entwickeln kleine Erklärvideos oder Comics, die denselben Inhalt verständlicher machen.", "skills": [{"key": "Kreativitaet", "weight": 1}]}, {"id": "C", "label": "Wir prüfen gemeinsam, ob die übernommenen Inhalte aus Online-Quellen korrekt und seriös sind.", "skills": [{"key": "Digital_Literacy", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_28", "text": "Für die Lagerverwaltung soll ein Chatbot entwickelt werden, der Standardfragen beantwortet.", "options": [{"id": "A", "label": "Ich zeige, wie sich die Antworten verändern, wenn man exakte Formulierungen eingibt. Die Azubis testen verschiedene Prompts und vergleichen die Ergebnisse.", "skills": [{"key": "Prompt_Engineering", "weight": 1}]}, {"id": "B", "label": "Wir bauen einfache Entscheidungsbäume im Chatbot und probieren die Abläufe durch.", "skills": [{"key": "Softwareentwicklung", "weight": 1}]}, {"id": "C", "label": "Wir diskutieren, welche Fragen sinnvoll sind und wo ein Mensch besser reagieren sollte.", "skills": [{"key": "Digitale_Ethik_und_KI_Governance", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_29", "text": "Im Büro müssen regelmäßig große Datenmengen (z. B. Kundendaten) geprüft werden.", "options": [{"id": "A", "label": "Ich lasse die Azubis Daten in ein KI-Tool einspeisen und beobachten, welche Muster oder Fehler die KI erkennt.", "skills": [{"key": "KI_Datenkompetenz", "weight": 1}]}, {"id": "B", "label": "Gemeinsam entwickeln wir klare Regeln, wie diese Daten strukturiert und abgelegt werden.", "skills": [{"key": "Datenmanagement", "weight": 1}]}, {"id": "C", "label": "Wir besprechen kritisch, ob die Ergebnisse der KI wirklich plausibel sind oder ob man manuell gegenprüfen muss.", "skills": [{"key": "Urteilsfaehigkeit", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_30", "text": "Ein Azubi schlägt vor, einen Teil der Qualitätskontrolle per App zu digitalisieren.", "options": [{"id": "A", "label": "Ich ermutige das Team, die neue Methode im Pilotlauf zu testen, auch wenn es ungewohnt ist.", "skills": [{"key": "Veraenderungskompetenz", "weight": 1}]}, {"id": "B", "label": "Der Azubi stellt seine Idee mit Prototyp-Screens vor und wir überlegen gemeinsam Verbesserungen.", "skills": [{"key": "Innovationskompetenz", "weight": 1}]}, {"id": "C", "label": "Wir passen Abläufe kurzfristig an, damit die App sinnvoll ausprobiert werden kann.", "skills": [{"key": "Agilitaet", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_31", "text": "Es soll ein einfaches Programm geschrieben werden, das automatisch Etiketten erstellt.", "options": [{"id": "A", "label": "Ich erkläre Grundlagen von Variablen und Schleifen und lasse die Azubis kleine Code-Teile selbst schreiben.", "skills": [{"key": "Softwareentwicklung", "weight": 1}]}, {"id": "B", "label": "Wir prüfen das Programm auf Fehler und verbessern es Schritt für Schritt.", "skills": [{"key": "Loesungsfaehigkeit", "weight": 1}]}, {"id": "C", "label": "Wenn ein Fehler wieder auftaucht, trainiere ich Geduld: „Fehler sind normal – probier’s nochmal, bis es läuft.“", "skills": [{"key": "Resilienz", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_32", "text": "Für einen Kundenauftrag müssen alle Sicherheitsanforderungen digital dokumentiert werden.", "options": [{"id": "A", "label": "Ich erkläre, wie man sichere Passwörter wählt, Daten verschlüsselt und Zugriffsrechte setzt.", "skills": [{"key": "Digitale_Infrastruktur_und_Cybersicherheit", "weight": 1}]}, {"id": "B", "label": "Wir diskutieren, warum Sicherheit auch Vertrauen beim Kunden bedeutet.", "skills": [{"key": "Werteorientiertes_Handeln", "weight": 1}]}, {"id": "C", "label": "Der Azubi übernimmt eigenständig die Verantwortung für eine Checkliste und zeigt, dass er es zuverlässig kann.", "skills": [{"key": "Eigenverantwortung_und_Selbstwirksamkeit", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_33", "text": "Im Rahmen einer Projektarbeit sollen die Azubis ihre Ergebnisse vor einem Gremium vorstellen.", "options": [{"id": "A", "label": "Jeder Azubi übernimmt einen Part, übt den Vortrag mehrmals und bekommt Feedback zu Stimme und Auftreten.", "skills": [{"key": "Selbstbewusstsein", "weight": 1}]}, {"id": "B", "label": "Wir laden Kolleg:innen mit anderem Hintergrund dazu ein, damit die Azubis ihre Präsentation auch für unterschiedliche Zielgruppen verständlich machen.", "skills": [{"key": "Weltoffenheit", "weight": 1}]}, {"id": "C", "label": "Nach der Präsentation müssen sie sich den kritischen Fragen des Gremiums stellen.", "skills": [{"key": "Dialog_und_Konfliktfaehigkeit", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_34", "text": "Die Azubis sollen sich auf eine Zwischenprüfung vorbereiten.", "options": [{"id": "A", "label": "Ich lasse sie ein KI-Tool nutzen, das aus den Lerninhalten Quizfragen generiert. So können sie ihren Wissensstand direkt testen.", "skills": [{"key": "KI_gestuetztes_Lernen_und_Weiterbildung", "weight": 1}]}, {"id": "B", "label": "Jeder Azubi entscheidet selbst, wie viele Quizrunden er macht und dokumentiert die Ergebnisse.", "skills": [{"key": "Eigenverantwortung_und_Selbstwirksamkeit", "weight": 1}]}, {"id": "C", "label": "Ich erkläre, dass falsche Antworten keine Niederlage sind, sondern Hinweise, wo man noch üben sollte.", "skills": [{"key": "Resilienz", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}, {"id": "AUA_35", "text": "Ein Azubi möchte sich zusätzlich auf eine neue Software spezialisieren.", "options": [{"id": "A", "label": "Ich zeige, wie er ein KI-gestütztes Trainingsprogramm nutzen kann, das seinen Lernfortschritt automatisch anpasst.", "skills": [{"key": "KI_gestuetztes_Lernen_und_Weiterbildung", "weight": 1}]}, {"id": "B", "label": "Wir legen fest, wo er seine Übungsdateien ablegt und wie die Ergebnisse dokumentiert werden.", "skills": [{"key": "Datenmanagement", "weight": 1}]}, {"id": "C", "label": "Der Azubi entwickelt eigene kleine Praxisübungen mit der Software und präsentiert sie im Team.", "skills": [{"key": "Kreativitaet", "weight": 1}]}, {"id": "D", "label": "Nichts davon passt für meine Situation.", "skills": []}]}];

/* ===== State ===== */
const allSkills = Object.values(CATEGORIES).flat();
const initialScores = allSkills.reduce((acc,k)=> (acc[k]=0, acc), {});
const STORAGE_KEY = "fs360_scores_aua";
const STORAGE_QIDX = "fs360_qidx_aua";
const BREAKS = [9,18,26];

function loadState(){
  try{
    const raw = sessionStorage.getItem(STORAGE_KEY);
    const qraw = sessionStorage.getItem(STORAGE_QIDX);
    const scores = raw ? JSON.parse(raw) : {...initialScores};
    const idx = qraw ? parseInt(qraw,10) : 0;
    return { scores, idx };
  }catch(e){ return { scores: {...initialScores}, idx: 0 }; }
}
function saveState(scores, idx){
  sessionStorage.setItem(STORAGE_KEY, JSON.stringify(scores));
  sessionStorage.setItem(STORAGE_QIDX, String(idx));
}
function resetState(){
  sessionStorage.removeItem(STORAGE_KEY);
  sessionStorage.removeItem(STORAGE_QIDX);
}
function formatSkillLabel(key){ return SKILL_LABELS[key] || key.replaceAll("_"," "); }
  // weiche Silbentrennung für deutsche Komposita (wirkt v.a. in Tabelle/PDF)
function softHyphenate(str){
  const SHY = "\u00AD"; // &shy;
  return str
    .replace(/Interkulturelle/g, "Inter"+SHY+"kulturelle")
    .replace(/Kommunikation/g, "Kommu"+SHY+"nikation")
    .replace(/Werteorientiertes/g, "Werte"+SHY+"orientiertes")
    .replace(/Eigenverantwortung/g, "Eigen"+SHY+"verantwortung")
    .replace(/Selbstwirksamkeit/g, "Selbst"+SHY+"wirksamkeit")
    .replace(/Innovationskompetenz/g, "Innovations"+SHY+"kompetenz")
    .replace(/Veränderungskompetenz/g, "Ver"+SHY+"änderungs"+SHY+"kompetenz")
    .replace(/Lösungsfähigkeit|Lösungsfähigkeit/g, "Lösungs"+SHY+"fähigkeit")
    .replace(/Urteilsfähigkeit/g, "Urteils"+SHY+"fähigkeit")
    .replace(/Cybersicherheit/g, "Cyber"+SHY+"sicherheit")
    .replace(/Nutzerzentriertes/g, "Nutzer"+SHY+"zentriertes")
    .replace(/Robotikentwicklung/g, "Robotik"+SHY+"entwicklung")
    .replace(/KI-gestütztes/g, "KI-gestütztes")
    .replace(/KI-Datenkompetenz/g, "KI-Daten"+SHY+"kompetenz")
    .replace(/Weltoffenheit/g, "Welt"+SHY+"offenheit");
}

// bricht lange Sunburst-Labels in 2 Zeilen (fügt <br> ein)
function wrapForSunburst(label){
  const clean = label.replace(/\s+/g," ").trim();

  // bevorzugte Bruchstellen rund um „ & “, „ / “, „-“ usw.
  const preferred = [" & ", " - ", " / "];
  for (const sep of preferred){
    const i = clean.indexOf(sep);
    if (i > 0 && clean.length > 18){
      return clean.slice(0, i).trim() + "<br>" + clean.slice(i).trim();
    }
  }
  // generisch: nach ~22 Zeichen am letzten Leerzeichen umbrechen
  const limit = 22;
  if (clean.length > limit){
    const cut = clean.lastIndexOf(" ", limit);
    if (cut > 0) return clean.slice(0, cut) + "<br>" + clean.slice(cut+1);
  }
  return clean;
}
function percent(n,d){ return d? Math.round((n/d)*100) : 0; }

/* ===== DOM ===== */
const introEl=document.getElementById("intro"), breakEl=document.getElementById("break"), quizEl=document.getElementById("quiz"), resEl=document.getElementById("results");
const qTextEl=document.getElementById("qText"), optionsEl=document.getElementById("options"), progressText=document.getElementById("progressText"), pbar=document.getElementById("pbar");
const errEl=document.getElementById("error"), prevBtn=document.getElementById("prevBtn"), nextBtn=document.getElementById("nextBtn");
const breakNextBtn=document.getElementById("breakNextBtn"), copyBtn=document.getElementById("copyBtn"), resetBtn=document.getElementById("resetBtn"), pdfBtn=document.getElementById("pdfBtn");
const estTime=document.getElementById("estTime"), countScenarios=document.getElementById("countScenarios"), skipToResults=document.getElementById("skipToResults");

let state = loadState();

function show(el){ el.classList.remove("hidden"); }
function hide(el){ el.classList.add("hidden"); }

function updateProgress(){
  const total=SCENARIOS.length||1;
  const cur=state.idx;
  progressText.textContent=`Szenario ${cur+1} / ${total}`;
  pbar.style.width=percent(cur,total)+"%";
}

function renderQuestion(){
  const idx=state.idx;
  const sc=SCENARIOS[idx];
  updateProgress();
  try{ setBgFromIndex(idx||0); }catch(e){}
  qTextEl.textContent = sc?.text || "Keine Szenarien gefunden.";
  optionsEl.innerHTML=""; errEl.textContent="";

  (sc?.options||[]).forEach((opt,i)=>{
    const id=`q${idx}_opt${i}`;
    const wrap=document.createElement("label");
    wrap.className="option";
    wrap.setAttribute("for",id);

    const badge=document.createElement("div");
    badge.className="optIndex";
    badge.textContent=(i+1);

    const input=document.createElement("input");
    input.type="radio"; input.name=`q${idx}`; input.id=id; input.value=opt.id;
    input.dataset.skills=JSON.stringify(opt.skills||[]);
    input.setAttribute("aria-label",opt.label);
    input.style.marginTop="0.15rem";

    const span=document.createElement("span");
    span.className="txt"; span.textContent=opt.label;

    wrap.appendChild(badge);
    wrap.appendChild(input);
    wrap.appendChild(span);
    optionsEl.appendChild(wrap);
  });

  prevBtn.disabled = idx===0;
  nextBtn.textContent = idx===(SCENARIOS.length-1) ? "Auswertung anzeigen" : "Weiter";
}

function applyAnswerAndNext(){
  const idx=state.idx;
  const selected=document.querySelector(`input[name="q${idx}"]:checked`);
  if(!selected){ errEl.textContent="Bitte wählen Sie eine Option aus."; return; }
  errEl.textContent="";
  const scores=state.scores;
  try{
    const skills=JSON.parse(selected.dataset.skills||"[]");
    if(Array.isArray(skills)){
      skills.forEach(s=>{
        if(s && s.key && (s.weight || s.weight===0) && scores.hasOwnProperty(s.key)){
          scores[s.key]+=Number(s.weight)||0;
        }
      });
    }
  }catch(e){}

  const nextIdx=idx+1;
  saveState(scores,nextIdx);
  if(nextIdx<SCENARIOS.length){
    state.idx=nextIdx;
    if(BREAKS.includes(nextIdx)){ hide(quizEl); show(breakEl); }
    else { renderQuestion(); }
  } else { renderResults(); }
}

function goPrev(){
  if(state.idx>0){
    state.idx-=1;
    saveState(state.scores,state.idx);
    renderQuestion();
  }
}

/* ===== Farbschema für Sunburst ===== */
function getCssVar(name){
  return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
}

function renderResults(){
  hide(introEl); hide(quizEl); hide(breakEl); show(resEl);
  try{ setBgFromIndex(SCENARIOS.length||0); }catch(e){}
  const scores=state.scores;

const labels=[], parents=[], values=[];
Object.keys(CATEGORIES).forEach(cat=>{
  const pretty = cat.replaceAll("_"," ");
  const skills = CATEGORIES[cat];
  const catSum = skills.reduce((sum,sk)=>sum+(scores[sk]||0),0);

  // Kategorie-Label im Diagramm umbrechen
  if(catSum>0){ labels.push(wrapForSunburst(pretty)); parents.push(""); values.push(catSum); }

  // Skill-Label: in der Grafik umbrochen, in der Tabelle weich getrennt (kommt später)
  skills.forEach(sk=>{
    const v = scores[sk]||0;
    if(v>0){
      const chartLabel = wrapForSunburst(SKILL_LABELS[sk] || sk.replaceAll("_"," "));
      labels.push(chartLabel);
      parents.push(wrapForSunburst(pretty));
      values.push(v);
    }
  });
});
  if(values.length===0){ labels.push("Keine Antworten"); parents.push(""); values.push(1); }

const cTech    = getCssVar('--cat-tech')    || '#234B59';
const cDigi    = getCssVar('--cat-digi')    || '#93B7BE';
const cClassic = getCssVar('--cat-classic') || '#F5C396';
const cTrans   = getCssVar('--cat-trans')   || '#78290F';

const catColorMap = new Map([
  ["Technologische Kompetenzen", cTech],
  ["Digitale Schluesselkompetenzen", cDigi],
  ["Klassische Kompetenzen", cClassic],
  ["Transformative Kompetenzen", cTrans]
  ]);

  const colors = labels.map((lbl, i) => {
    if (parents[i]==="") return catColorMap.get(lbl) || cPrimary; // Kategorien
    const base = catColorMap.get(parents[i]) || cPrimary;         // Skills -> leichte Abstufung
    return shadeColor(base, 0.12 * (i % 5));
  });

  Plotly.newPlot("chart", [{
    type:"sunburst",
    labels, parents, values, branchvalues:"total",
    hovertemplate:"%{label}: %{value}<extra></extra>",
    insidetextorientation:"radial",
    marker:{ colors }
  }], {
    margin:{l:0,r:0,t:0,b:0},
    paper_bgcolor:"rgba(0,0,0,0)",
    plot_bgcolor:"rgba(0,0,0,0)"
  }, {displayModeBar:false,responsive:true});

  const tableWrap=document.getElementById("tableWrap");
  const rows=Object.values(CATEGORIES).flat().map(sk=>`<tr><td>${formatSkillLabel(sk)}</td><td>${scores[sk]||0}</td></tr>`).join("");
  tableWrap.innerHTML=`<table aria-describedby="res-h"><thead><tr><th>Skill</th><th>Punkte</th></tr></thead><tbody>${rows}</tbody></table>`;
}

function shadeColor(hex, t){
  const ctx = document.createElement('canvas').getContext('2d');
  ctx.fillStyle = hex;
  const rgb = ctx.fillStyle;
  const m = rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
  if(!m) return hex;
  let [r,g,b] = [parseInt(m[1],10), parseInt(m[2],10), parseInt(m[3],10)];
  r/=255; g/=255; b/=255;
  const max=Math.max(r,g,b), min=Math.min(r,g,b);
  let h,s,l=(max+min)/2;
  if(max===min){ h=s=0; } else {
    const d=max-min;
    s = l>0.5? d/(2-max-min) : d/(max+min);
    switch(max){ case r: h=(g-b)/d+(g<b?6:0); break;
                 case g: h=(b-r)/d+2; break;
                 default: h=(r-g)/d+4; }
    h/=6;
  }
  l = Math.min(1, Math.max(0, l + t));
  let r2,g2,b2;
  if(s===0){ r2=g2=b2=l; }
  else{
    const q = l<0.5? l*(1+s) : l+s-l*s;
    const p = 2*l-q;
    const hue2rgb=(p,q,t)=>{ if(t<0)t+=1; if(t>1)t-=1;
      if(t<1/6)return p+(q-p)*6*t; if(t<1/2)return q; if(t<2/3)return p+(q-p)*(2/3 - t)*6; return p; };
    r2=hue2rgb(p,q,h+1/3); g2=hue2rgb(p,q,h); b2=hue2rgb(p,q,h-1/3);
  }
  r2=Math.round(r2*255); g2=Math.round(g2*255); b2=Math.round(b2*255);
  return `rgb(${r2}, ${g2}, ${b2})`;
}

/* Events */
document.getElementById("startBtn").addEventListener("click",()=>{ hide(introEl); show(quizEl); if(countScenarios) countScenarios.textContent=SCENARIOS.length; renderQuestion(); });
document.getElementById("skipToResults").addEventListener("click",()=>{ renderResults(); });
document.getElementById("nextBtn").addEventListener("click",applyAnswerAndNext);
document.getElementById("prevBtn").addEventListener("click",goPrev);
document.getElementById("breakNextBtn").addEventListener("click",()=>{ hide(breakEl); show(quizEl); renderQuestion(); });
document.getElementById("resetBtn").addEventListener("click",()=>{ resetState(); state=loadState(); hide(resEl); show(introEl); document.getElementById("title").focus?.(); });
document.getElementById("copyBtn").addEventListener("click",()=>{
  const scores=state.scores; let text="FutureSkills360° - Ausbilder:innen, Ausbildungspersonal und Personalverantwortliche – Kurzreport\n\n";
  Object.keys(CATEGORIES).forEach(cat=>{
    text+=`# ${cat.replaceAll("_"," ")}\n`;
    CATEGORIES[cat].forEach(sk=>{ text+=`- ${formatSkillLabel(sk)}: ${scores[sk]||0}\n`; });
    text+="\n";
  });
  navigator.clipboard.writeText(text).then(()=>alert("Kurzreport in die Zwischenablage kopiert.")).catch(()=>alert("Kopieren nicht möglich. Bitte manuell markieren und kopieren."));
});

// Zeit-Schätzung
(function(){
  const total=SCENARIOS.length; const perQ=12;
  const minutes=Math.max(1,Math.round((total*perQ)/60));
  if(estTime) estTime.textContent=`geschätzt: ${total} Szenarien · ca. ${minutes} Min.`;
  if(countScenarios) countScenarios.textContent=total;
})();

// PDF Export (mit Hintergrundbild aus der Auswertung)
document.getElementById("pdfBtn").addEventListener("click", async ()=>{
  try{
    const BG_SRC = "IDW_201222_0902_1920.webp";
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit:"pt", format:"a4" });
    const pageWidth = doc.internal.pageSize.getWidth();
    const pageHeight = doc.internal.pageSize.getHeight();
    const margin = 40; let y = margin;

    // Helpers --------------------------------------------------------------
    const loadImage = (src) => new Promise((res, rej) => {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => res(img);
      img.onerror = rej;
      img.src = src;
    });

    // zeichnet img als "cover" auf ein Canvas mit globalAlpha
    const makeBackgroundDataURL = async (src, w, h, alpha=0.08) => {
      const img = await loadImage(src);
      const canvas = document.createElement("canvas");
      canvas.width = Math.floor(w);
      canvas.height = Math.floor(h);
      const ctx = canvas.getContext("2d");

      // weißer Grund (für sauberes Blending im PDF)
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0,0,w,h);

      // cover-Berechnung
      const scale = Math.max(w / img.width, h / img.height);
      const dw = img.width * scale;
      const dh = img.height * scale;
      const dx = (w - dw) / 2;
      const dy = (h - dh) / 2;

      ctx.globalAlpha = alpha;
      ctx.drawImage(img, dx, dy, dw, dh);
      ctx.globalAlpha = 1;

      return canvas.toDataURL("image/png"); // sicheres Format für jsPDF
    };
    // ---------------------------------------------------------------------

    // 1) Hintergrundbild ganzseitig (dezent)
    const bgDataUrl = await makeBackgroundDataURL(BG_SRC, pageWidth, pageHeight, 0.08);
    doc.addImage(bgDataUrl, "PNG", 0, 0, pageWidth, pageHeight, "", "FAST");

    // 2) Kopf
    doc.setFont("helvetica","bold"); doc.setFontSize(14);
    doc.text("FutureSkills360° - Ausbilder:innen, Ausbildungspersonal und Personalverantwortliche", margin, y);
    y += 18;
    doc.setFont("helvetica","normal"); doc.setFontSize(10);
    doc.text(new Date().toLocaleString(), margin, y);
    y += 12;

    // 3) Diagramm
    const chartDiv = document.getElementById("chart");
    const chartPng = await Plotly.toImage(chartDiv, { format:"png", width: 900, height: 600 });
    const imgW = pageWidth - margin*2;
    const imgH = imgW * (600/900);
    y += 8;
    doc.addImage(chartPng, "PNG", margin, y, imgW, imgH, "", "FAST");
    y += imgH + 16;

    // 4) Tabelle
    const table = document.getElementById("tableWrap");
    const canvas = await html2canvas(table, { scale: 2, backgroundColor: null });
    const tablePng = canvas.toDataURL("image/png");
    const tW = pageWidth - margin*2;
    const tH = tW * (canvas.height / canvas.width);

    if (y + tH > pageHeight - margin) {
      doc.addPage();
      // pro neue Seite ebenfalls den dezenten Hintergrund setzen
      const bg2 = await makeBackgroundDataURL(BG_SRC, pageWidth, pageHeight, 0.08);
      doc.addImage(bg2, "PNG", 0, 0, pageWidth, pageHeight, "", "FAST");
      y = margin;
    }
    doc.addImage(tablePng, "PNG", margin, y, tW, tH, "", "FAST");

    // 5) Fußnote
    doc.setFontSize(8);
    doc.text("Hinweis: Werte basieren auf Ihren Antworten in dieser Sitzung. Keine Speicherung personenbezogener Daten.", margin, pageHeight - margin/2);

    doc.save("FutureSkills360_AuA_Ergebnis.pdf");
  }catch(err){
    alert("PDF-Export nicht möglich: " + (err?.message || err));
  }
});

/* ===== Keyboard Shortcuts ===== */
document.addEventListener("keydown", (e) => {
  if (quizEl.classList.contains("hidden")) return; // nur im Quiz aktiv

  // Zahlentasten 1-4 -> Option auswählen
  if (["1","2","3","4"].includes(e.key)) {
    const idx = parseInt(e.key, 10) - 1;
    const inputs = optionsEl.querySelectorAll("input[type=radio]");
    if (inputs[idx]) {
      inputs[idx].checked = true;
      inputs[idx].focus();
      e.preventDefault();
    }
  }

  // Enter -> Weiter
  if (e.key === "Enter") {
    e.preventDefault();
    nextBtn.click();
  }

  // Backspace -> Zurück
  if (e.key === "Backspace") {
    e.preventDefault();
    prevBtn.click();
  }
});
</script>
</body>
</html>
